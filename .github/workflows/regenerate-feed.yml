name: Regenerate RSS feed

on:
	schedule:
		- cron: '0 */6 * * *' # every 6 hours
	workflow_dispatch: {}

jobs:
	regen:
		runs-on: ubuntu-latest
		steps:
			- name: Checkout
				uses: actions/checkout@v4
				with:
					fetch-depth: 0

			- name: Setup Python
				uses: actions/setup-python@v4
				with:
					python-version: '3.11'

			- name: Install dependencies
				run: |
					python -m pip install --upgrade pip
					if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

			- name: Run generator
				run: |
					python scripts/run_generator_for_ci.py

			- name: Commit changes if any
				env:
					GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
				run: |
					git config user.name "github-actions[bot]"
					git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
					git add folkborsen_feed.xml || true
					if git diff --staged --quiet; then
						echo "No changes to commit"
					else
						git commit -m "chore: auto-regenerate RSS feed [skip ci]" || true
						git push origin HEAD:main
					fi

